<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= post.title %> - MyBlog</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body data-post-id="<%= post._id %>">
  <%- include("partials/navbar") %>

  <div class="container mt-5">

    <!-- Blog Title & Thumbnail -->
    <h1 class="mb-3"><%= post.title %></h1>
    <% if (post.thumbnail) { %>
      <img src="/images/uploads/<%= post.thumbnail %>" class="img-fluid rounded mb-3" style="max-height:300px; object-fit:cover;">
    <% } %>

    <!-- Author & Date -->
   <p> <a class="text-muted" href="/user/<%= post.user._id %>">By <%= post.user.name %></a> | <%= post.createdAt.toDateString() %></p>

    <!-- Content -->
    <p class="lead"><%= post.content %></p>

    <!-- Tags -->
    <% if (post.tags && post.tags.length > 0) { %>
      <p><strong>Tags:</strong>
        <% post.tags.forEach(tag => { %>
          <span class="badge bg-secondary"><%= tag %></span>
        <% }) %>
      </p>
    <% } %>
    <!-- Category -->
    <% if (post.category) { %>
  <p>
    <strong>Category:</strong>
    <a href="/blogs/category/<%= post.category %>" class="text-decoration-none"><%= post.category %></a>
  </p>
<% } %>


    <!-- Back & Like Buttons -->
    <div class="mt-4 d-flex gap-2">
      <a href="/blogs" class="btn btn-secondary">‚¨Ö Back</a>
      <% if (user) { %>
        <button id="likeBtn" class="btn btn-outline-danger">
          ‚ù§Ô∏è Like (<span id="likeCount"><%= post.likes.length %></span>)
        </button>
      <% } else { %>
        <a href="/login" class="btn btn-outline-danger">‚ù§Ô∏è Like (<%= post.likes.length %>)</a>
      <% } %>
    </div>

    <!-- Comments Section -->
    <div class="mt-5">
      <h4 class="mb-3">üí¨ Comments (<span id="commentCount"><%= post.comments.length %></span>)</h4>

      <!-- Comment Form -->
      <% if (user) { %>
        <form id="commentForm" class="mb-4">
          <div class="input-group">
            <input type="text" id="commentInput" name="text" class="form-control" placeholder="Write a comment..." required>
            <button class="btn btn-primary">Post</button>
          </div>
        </form>
      <% } else { %>
        <p><a href="/login">Login</a> to comment.</p>
      <% } %>

      <!-- Comments List -->
      <ul class="list-group" id="commentList">
        <% if (post.comments && post.comments.length > 0) { %>
          <% post.comments.forEach(comment => { %>
            <li class="list-group-item" id="comment-<%= comment._id %>">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong>
                    <% if (comment.user.profilepic) { %>
                      <img src="/images/uploads/<%= comment.user.profilepic %>" 
                           class="rounded-circle me-2" style="width:30px;height:30px;object-fit:cover;">
                    <% } %>
                    <%= comment.user.name %>
                  </strong>
                  : <span class="comment-text"><%= comment.text %></span>
                  <br>
                  <small class="text-muted"><%= comment.createdAt.toDateString() %></small>
                </div>

                <% if (user && comment.user._id.toString() === user.id) { %>
                  <div class="d-flex gap-2">
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleEditForm('<%= comment._id %>')">Edit</button>
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteComment('<%= comment._id %>')">Delete</button>
                  </div>
                <% } %>
              </div>

              <!-- Edit Form -->
              <form id="edit-form-<%= comment._id %>" class="mt-2 d-none">
                <div class="input-group">
                  <input type="text" name="text" value="<%= comment.text %>" class="form-control" required>
                  <button class="btn btn-success btn-sm">Save</button>
                  <button type="button" class="btn btn-secondary btn-sm" onclick="toggleEditForm('<%= comment._id %>')">Cancel</button>
                </div>
              </form>
            </li>
          <% }) %>
        <% } else { %>
          <p class="text-muted">No comments yet. Be the first!</p>
        <% } %>
      </ul>
    </div>
  </div>

  <!-- JS -->
  <script src="/js/blog.js"></script>
</body>
</html>
<%- include("partials/footer") %>