<!DOCTYPE html>
<html lang="en">

<head>
  <title>My Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
</head>

<body>
  <%- include("partials/navbar") %>

    <div class="container mt-5">
      <h1 class="mb-4 text-center">üë§ My Profile</h1>
      <%- include("partials/alerts") %>

        <!-- User Info Card -->
        <div class="card shadow-sm mb-5 p-4 text-center">
          <img src="<%= user.profilepic ? '/images/uploads/'+ user.profilepic : '/images/default-profile.png' %>"
            alt="Profile Picture" class="profile-pic mb-3">
            <div  class="text-center mb-3"  >
              <h5> Following:<%= user.following.length %> | Followers:<%= user.followers.length %> </h5>
            </div>
          
          <h3>
            <%= user.name %>
          </h3>
          <p class="text-muted">@<%= user.username %>
          </p>
          <p>Email: <%= user.email %>
          </p>
          <p>Age: <%= user.age %>
          </p>
          <p>Bio: <%= user.bio || "This user has no bio yet." %>
          </p>
          <p>Role: <%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %>
          </p>
          <div class="d-flex justify-content-center">
            <a href="/user/edit" class="btn btn-primary me-2">Edit Profile</a>
            <a href="/user/profilepicture" class="btn btn-outline-primary">Change Profile Picture</a>
          </div>
        </div>

        <!-- User Stats Section -->
        
          <div class="card shadow-sm mb-3 p-4 text-cente">
            <div class="card text-center p-3">
              <h4 class="mb-3">
                <%= user.name %>'s Blogs (<%= user.posts.length %>)
              </h4>
              <div class="row mb-4">
                <div class="col-md-4">
                  <div class="card text-center p-3">
                    <h5>Total Blogs</h5>
                    <h3>
                      <%= totalBlogs %>
                    </h3>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card text-center p-3">
                    <h5>Total Likes</h5>
                    <h3>
                      <%= totalLikes %>
                    </h3>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card text-center p-3">
                    <h5>Most Popular Blog</h5>
                    <% if (mostPopularBlog) { %>
                      <a href="/blogs/<%= mostPopularBlog._id %>">
                        <%= mostPopularBlog.title %>
                      </a>
                      <p>
                        <%= mostPopularBlog.likes.length %> ‚ù§Ô∏è
                      </p>
                      <% } else { %>
                        <p>None</p>
                        <% } %>
                  </div>
                </div>
              </div>
            </div>
          </div>
       

        <!-- User Blogs Section -->
        <h2 class="mb-4">üìù My Blogs</h2>
        <div class="row">
          <% if (user.posts && user.posts.length> 0) { %>
            <% user.posts.forEach(post=> { %>
              <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm">
                  <img src="/images/uploads/<%= post.thumbnail || 'default-blog.jpg' %>" class="card-img-top"
                    style="height:200px; object-fit:cover;">

                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">
                      <%= post.title %>
                    </h5>
                    <p class="card-text text-muted">
                      <%= post.content.substring(0, 80) %>...
                    </p>

                    <div class="mt-auto">
                      <a href="/blogs/<%= post._id %>" class="btn btn-sm btn-outline-primary">View</a>
                      <a href="/blogs/edit/<%= post._id %>" class="btn btn-sm btn-warning">Edit</a>
                      <a href="/blogs/delete/<%= post._id %>" class="btn btn-sm btn-danger"
                        onclick="return confirm('Are you sure you want to delete this blog?')">Delete</a>
                    </div>
                  </div>
                  <div class="card-footer text-muted small">
                    Created on <%= post.createdAt.toDateString() %>
                  </div>
                </div>
              </div>
              <% }) %>
                <% } else { %>
                  <p class="text-center text-muted">You haven‚Äôt written any blogs yet. <a href="/blogs/create">Create
                      one</a>!</p>
                  <% } %>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light text-center py-3 mt-5">
      <p class="mb-0">¬© <%= new Date().getFullYear() %> MyBlog | All Rights Reserved</p>
    </footer>
</body>

</html>